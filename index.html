<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My購了沒(˶˙๏˙˶)b</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: black; margin: 0; color: white; overflow-x: hidden; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        #root { min-height: 100vh; }
        input, select, button { outline: none !important; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, deleteDoc, collection, onSnapshot, query, addDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        window.FirebaseSDK = { 
            initializeApp, getAuth, signInAnonymously, onAuthStateChanged, 
            signInWithCustomToken, getFirestore, doc, setDoc, getDoc, 
            updateDoc, deleteDoc, collection, onSnapshot, query, addDoc 
        };
        window.dispatchEvent(new Event('firebase-ready'));
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        const Icons = {
            Settings: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
            List: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>,
            BarChart2: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>,
            Camera: ({size}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>,
            CheckCircle2: ({size}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="m9 12 2 2 4-4"/></svg>,
            Circle: ({size}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/></svg>,
            X: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        };

        const App = () => {
            const [fbReady, setFbReady] = useState(!!window.FirebaseSDK);
            const [user, setUser] = useState(null);
            const [view, setView] = useState('list'); 
            const [statMode, setStatMode] = useState('category'); 
            const [items, setItems] = useState([]);
            const [targets, setTargets] = useState(["自己", "家人", "朋友"]);
            const [cats, setCats] = useState(["藥妝", "零食", "精品"]);
            const [newTargetInput, setNewTargetInput] = useState("");
            const [newCatInput, setNewCatInput] = useState("");
            const [selT, setSelT] = useState("自己");
            const [selC, setSelC] = useState("藥妝");
            const [name, setName] = useState("");
            const [price, setPrice] = useState("");
            const [currency, setCurrency] = useState("TWD");
            const [img, setImg] = useState(null);
            const [editingId, setEditingId] = useState(null);
            const [rates, setRates] = useState({ KRW: 41, JPY: 4.6, USD: 0.031 });
            const [showSettings, setShowSettings] = useState(false);
            const [deleteConfirmId, setDeleteConfirmId] = useState(null);

            const chartRef = useRef(null);
            const chartInstance = useRef(null);
            const firebaseInstance = useRef(null);

            // 1. 初始化讀取
            useEffect(() => {
                const handleReady = () => setFbReady(true);
                window.addEventListener('firebase-ready', handleReady);
                
                const localItems = localStorage.getItem('tako_items');
                if (localItems) setItems(JSON.parse(localItems));
                const localTags = localStorage.getItem('tako_tags');
                if (localTags) {
                    const d = JSON.parse(localTags);
                    if (d.targets) setTargets(d.targets);
                    if (d.cats) setCats(d.cats);
                }
                return () => window.removeEventListener('firebase-ready', handleReady);
            }, []);

            // 2. Firebase 連線
            useEffect(() => {
                if (!fbReady) return;
                const sdk = window.FirebaseSDK;
                const config = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
                if (!config || !config.apiKey) return;

                const app = sdk.initializeApp(config);
                const auth = sdk.getAuth(app);
                const db = sdk.getFirestore(app);
                firebaseInstance.current = { auth, db };

                const initAuth = async () => {
                    try {
                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            await sdk.signInWithCustomToken(auth, __initial_auth_token);
                        } else {
                            await sdk.signInAnonymously(auth);
                        }
                    } catch (e) { console.error("Auth Error:", e); }
                };
                initAuth();
                const unsubscribe = sdk.onAuthStateChanged(auth, setUser);
                return () => unsubscribe();
            }, [fbReady]);

            // 3. 雲端同步
            useEffect(() => {
                if (!user || !firebaseInstance.current) return;
                const { db } = firebaseInstance.current;
                const sdk = window.FirebaseSDK;
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'my-shopping-tako-v1';

                const unsubItems = sdk.onSnapshot(sdk.collection(db, 'artifacts', appId, 'users', user.uid, 'items'), (snap) => {
                    const data = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                    const sorted = data.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
                    setItems(sorted);
                    localStorage.setItem('tako_items', JSON.stringify(sorted));
                });

                const unsubSettings = sdk.onSnapshot(sdk.doc(db, 'artifacts', appId, 'users', user.uid, 'settings', 'tags'), (snap) => {
                    if (snap.exists()) {
                        const d = snap.data();
                        if (d.targets) setTargets(d.targets);
                        if (d.cats) setCats(d.cats);
                        localStorage.setItem('tako_tags', JSON.stringify(d));
                    }
                });
                return () => { unsubItems(); unsubSettings(); };
            }, [user]);

            useEffect(() => {
                fetch('https://open.er-api.com/v6/latest/TWD').then(r => r.json()).then(d => setRates(d.rates)).catch(() => {});
            }, []);

            const stats = useMemo(() => {
                const boughtItems = items.filter(i => i.bought);
                const dataMap = {};
                const key = statMode === 'category' ? 'category' : 'target';
                boughtItems.forEach(item => {
                    const val = item[key] || "未分類";
                    dataMap[val] = (dataMap[val] || 0) + (item.priceInTWD || 0);
                });
                return { dataMap, total: Object.values(dataMap).reduce((a, b) => a + b, 0) };
            }, [items, statMode]);

            useEffect(() => {
                if (view === 'stats' && chartRef.current && Object.keys(stats.dataMap).length > 0) {
                    const ctx = chartRef.current.getContext('2d');
                    if (chartInstance.current) chartInstance.current.destroy();
                    chartInstance.current = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: Object.keys(stats.dataMap),
                            datasets: [{
                                data: Object.values(stats.dataMap),
                                backgroundColor: ['#FFFFFF', '#D1D1D6', '#8E8E93', '#48484A', '#2C2C2E', '#636366'],
                                borderWidth: 0
                            }]
                        },
                        options: { cutout: '70%', plugins: { legend: { display: false } }, maintainAspectRatio: false }
                    });
                }
            }, [view, stats]);

            // 設定保存與管理
            const saveTags = async (newT, newC) => {
                localStorage.setItem('tako_tags', JSON.stringify({ targets: newT, cats: newC }));
                if (!user || !firebaseInstance.current) return;
                const { db } = firebaseInstance.current;
                const sdk = window.FirebaseSDK;
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'my-shopping-tako-v1';
                try {
                    await sdk.setDoc(sdk.doc(db, 'artifacts', appId, 'users', user.uid, 'settings', 'tags'), { targets: newT, cats: newC, updatedAt: Date.now() }, { merge: true });
                } catch(e) {}
            };

            const handleAddTarget = () => {
                if (!newTargetInput.trim()) return;
                const newList = [...targets, newTargetInput.trim()];
                setTargets(newList);
                saveTags(newList, cats);
                setNewTargetInput("");
            };

            const handleAddCat = () => {
                if (!newCatInput.trim()) return;
                const newList = [...cats, newCatInput.trim()];
                setCats(newList);
                saveTags(targets, newList);
                setNewCatInput("");
            };

            // 品項操作
            const handleSaveItem = async () => {
                if (!name.trim()) return;
                const p = parseFloat(price) || 0;
                const twd = currency === 'TWD' ? p : (p / (rates[currency] || 1));
                const data = { name: name.trim(), price: p, currency, target: selT, category: selC, priceInTWD: twd, image: img, updatedAt: Date.now() };
                
                if (user && firebaseInstance.current) {
                    const { db } = firebaseInstance.current;
                    const sdk = window.FirebaseSDK;
                    const appId = typeof __app_id !== 'undefined' ? __app_id : 'my-shopping-tako-v1';
                    if (editingId) {
                        await sdk.updateDoc(sdk.doc(db, 'artifacts', appId, 'users', user.uid, 'items', editingId), data);
                    } else {
                        await sdk.addDoc(sdk.collection(db, 'artifacts', appId, 'users', user.uid, 'items'), { ...data, bought: false, createdAt: Date.now() });
                    }
                } else {
                    let newItems;
                    if (editingId) {
                        newItems = items.map(i => i.id === editingId ? { ...i, ...data } : i);
                    } else {
                        newItems = [{ ...data, id: Date.now().toString(), bought: false, createdAt: Date.now() }, ...items];
                    }
                    setItems(newItems);
                    localStorage.setItem('tako_items', JSON.stringify(newItems));
                }
                setName(""); setPrice(""); setImg(null); setEditingId(null);
            };

            const handleToggleBought = async (item) => {
                const newVal = !item.bought;
                if (user && firebaseInstance.current) {
                    const { db } = firebaseInstance.current;
                    const sdk = window.FirebaseSDK;
                    const appId = typeof __app_id !== 'undefined' ? __app_id : 'my-shopping-tako-v1';
                    await sdk.updateDoc(sdk.doc(db, 'artifacts', appId, 'users', user.uid, 'items', item.id), { bought: newVal });
                } else {
                    const newItems = items.map(i => i.id === item.id ? { ...i, bought: newVal } : i);
                    setItems(newItems);
                    localStorage.setItem('tako_items', JSON.stringify(newItems));
                }
            };

            const handleDeleteItem = async (id) => {
                if (user && firebaseInstance.current) {
                    const { db } = firebaseInstance.current;
                    const sdk = window.FirebaseSDK;
                    const appId = typeof __app_id !== 'undefined' ? __app_id : 'my-shopping-tako-v1';
                    await sdk.deleteDoc(sdk.doc(db, 'artifacts', appId, 'users', user.uid, 'items', id));
                } else {
                    const newItems = items.filter(i => i.id !== id);
                    setItems(newItems);
                    localStorage.setItem('tako_items', JSON.stringify(newItems));
                }
                setDeleteConfirmId(null);
            };

            return (
                <div className="min-h-screen bg-black text-white pb-32 font-sans antialiased relative">
                    <header className="sticky top-0 z-40 bg-black/80 backdrop-blur-xl border-b border-white/5 px-6 py-6">
                        <div className="max-w-xl mx-auto flex justify-between items-center">
                            <h1 className="text-xl font-black tracking-widest uppercase">My購了沒<span className="opacity-40 lowercase ml-1">(˶˙๏˙˶)b</span></h1>
                            <button onClick={() => setShowSettings(true)} className="p-3 bg-white/5 rounded-full border border-white/10 active:scale-90 transition-all"><Icons.Settings /></button>
                        </div>
                    </header>

                    <main className="max-w-xl mx-auto px-5 pt-6 space-y-8">
                        {view === 'list' ? (
                            <>
                                <section className="bg-zinc-900/40 p-6 rounded-[2.5rem] border border-white/10 space-y-6 shadow-2xl">
                                    <div className="space-y-4">
                                        <div className="flex gap-2 overflow-x-auto no-scrollbar py-1">
                                            {targets.map(t => (
                                                <button key={t} onClick={() => setSelT(t)} className={`px-5 py-2.5 rounded-full text-[10px] font-black transition-all flex-none ${selT === t ? 'bg-white text-black' : 'bg-white/5 text-white/40'}`}>{t}</button>
                                            ))}
                                        </div>
                                        <div className="flex gap-2 overflow-x-auto no-scrollbar py-1">
                                            {cats.map(c => (
                                                <button key={c} onClick={() => setSelC(c)} className={`px-5 py-2.5 rounded-full text-[10px] font-black transition-all flex-none ${selC === c ? 'bg-zinc-800 text-white border border-white/10' : 'bg-white/5 text-white/40'}`}>{c}</button>
                                            ))}
                                        </div>
                                    </div>
                                    <input value={name} onChange={e => setName(e.target.value)} placeholder="想要買什麼..." className="w-full bg-white/5 border-none rounded-2xl py-4 px-6 text-sm font-black focus:ring-1 focus:ring-white/20 text-white" />
                                    <div className="flex bg-white/5 rounded-2xl items-center overflow-hidden border border-white/5">
                                        <input type="number" value={price} onChange={e => setPrice(e.target.value)} placeholder="金額" className="flex-1 bg-transparent border-none py-4 text-left font-black text-lg font-mono focus:ring-0 pl-6 text-white" />
                                        <div className="h-8 w-px bg-white/10 ml-2"></div>
                                        <select value={currency} onChange={e => setCurrency(e.target.value)} className="bg-transparent border-none text-[10px] font-black px-6 text-white focus:ring-0 uppercase cursor-pointer">
                                            <option value="TWD" className="bg-zinc-900">TWD</option>
                                            <option value="KRW" className="bg-zinc-900">KRW</option>
                                            <option value="JPY" className="bg-zinc-900">JPY</option>
                                            <option value="USD" className="bg-zinc-900">USD</option>
                                        </select>
                                    </div>
                                    <div className="flex gap-3">
                                        <button onClick={() => document.getElementById('cam-fix').click()} className="flex-1 h-14 bg-white/5 rounded-2xl flex items-center justify-center text-[10px] font-black gap-2 border border-white/5 text-white">{img ? '✓ 已選照片' : <Icons.Camera size={18}/>}</button>
                                        <button onClick={handleSaveItem} className="px-12 h-14 bg-white text-black rounded-2xl font-black text-[11px] tracking-widest uppercase active:scale-95 transition-transform">{editingId ? '儲存' : '新增'}</button>
                                    </div>
                                    <input type="file" id="cam-fix" className="hidden" accept="image/*" onChange={e => {
                                        const f = e.target.files[0];
                                        if (f) { const r = new FileReader(); r.onload = ev => setImg(ev.target.result); r.readAsDataURL(f); }
                                    }} />
                                </section>

                                <div className="space-y-6">
                                    {items.map(item => (
                                        <div key={item.id} className="bg-zinc-900/30 rounded-[2.5rem] border border-white/5 overflow-hidden transition-all">
                                            <div className={`relative h-60 bg-zinc-950 flex items-center justify-center transition-opacity ${item.bought ? 'opacity-40 grayscale-[0.5]' : 'opacity-100'}`}>
                                                {item.image ? <img src={item.image} className="w-full h-full object-cover" alt="" /> : <div className="text-white/5 font-black text-4xl italic">TAKO</div>}
                                                <div className="absolute top-5 left-5 flex gap-2">
                                                    <span className="bg-white/90 text-black px-3 py-1.5 rounded-full text-[8px] font-black uppercase">{item.target}</span>
                                                    <span className="bg-black/40 backdrop-blur-md text-white px-3 py-1.5 rounded-full text-[8px] font-black uppercase border border-white/10">{item.category}</span>
                                                </div>
                                            </div>
                                            <div className="p-8 space-y-6">
                                                <div className={`flex justify-between items-center transition-opacity ${item.bought ? 'opacity-40' : 'opacity-100'}`}>
                                                    <div className="min-w-0">
                                                        <h3 className="text-xl font-black truncate">{item.name}</h3>
                                                        <p className="font-black text-white/60 text-sm mt-1 uppercase tracking-tight">
                                                            ${Math.round(item.priceInTWD).toLocaleString()} TWD
                                                        </p>
                                                    </div>
                                                    <button onClick={() => handleToggleBought(item)} className={`p-4 rounded-full transition-all ${item.bought ? 'bg-white text-black' : 'bg-white/5 text-white/30 border border-white/5'}`}>
                                                        {item.bought ? <Icons.CheckCircle2 size={24}/> : <Icons.Circle size={24}/>}
                                                    </button>
                                                </div>
                                                <div className="flex gap-2 pt-4 border-t border-white/5">
                                                    <button onClick={() => {setEditingId(item.id); setName(item.name); setPrice(item.price.toString()); setCurrency(item.currency); setSelT(item.target); setSelC(item.category); setImg(item.image); window.scrollTo({top:0, behavior:'smooth'})}} className="flex-1 py-3 bg-white/10 rounded-xl text-[9px] font-black text-white uppercase tracking-widest transition-colors active:scale-95">編輯</button>
                                                    <button onClick={() => setDeleteConfirmId(item.id)} className="flex-1 py-3 bg-red-500/20 rounded-xl text-[9px] font-black text-red-500 uppercase tracking-widest transition-colors active:scale-95">刪除</button>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </>
                        ) : (
                            <div className="space-y-10 animate-in fade-in py-6">
                                <div className="bg-zinc-900/50 p-1.5 rounded-full border border-white/10 flex">
                                    <button onClick={() => setStatMode('category')} className={`flex-1 py-3 rounded-full text-[10px] font-black uppercase transition-all ${statMode === 'category' ? 'bg-white text-black' : 'text-white/30'}`}>類別</button>
                                    <button onClick={() => setStatMode('target')} className={`flex-1 py-3 rounded-full text-[10px] font-black uppercase transition-all ${statMode === 'target' ? 'bg-white text-black' : 'text-white/30'}`}>對象</button>
                                </div>
                                <div className="relative h-72 flex items-center justify-center">
                                    {Object.keys(stats.dataMap).length > 0 ? (
                                        <>
                                            <canvas ref={chartRef}></canvas>
                                            <div className="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                                                <p className="text-[10px] font-black text-white/30 uppercase tracking-widest">總計花費</p>
                                                <p className="text-2xl font-black mt-1 text-white">${Math.round(stats.total).toLocaleString()}</p>
                                            </div>
                                        </>
                                    ) : <div className="text-white/20 font-black italic">尚無數據</div>}
                                </div>
                                <div className="space-y-3">
                                    {Object.entries(stats.dataMap).map(([label, val]) => (
                                        <div key={label} className="flex justify-between items-center p-6 bg-zinc-900/40 rounded-3xl border border-white/5">
                                            <span className="text-[11px] font-black uppercase text-white/60 tracking-widest">{label}</span>
                                            <span className="font-black text-lg text-white">${Math.round(val).toLocaleString()}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </main>

                    <nav className="fixed bottom-10 inset-x-0 flex justify-center z-30">
                        <div className="bg-black/90 backdrop-blur-2xl px-12 py-5 rounded-full border border-white/10 flex gap-20 shadow-2xl items-center">
                            <button onClick={() => setView('list')} className={view === 'list' ? 'text-white' : 'text-white/20'}><Icons.List/></button>
                            <button onClick={() => setView('stats')} className={view === 'stats' ? 'text-white' : 'text-white/20'}><Icons.BarChart2/></button>
                        </div>
                    </nav>

                    {/* SETTINGS PANEL */}
                    {showSettings && (
                        <div className="fixed inset-0 z-[100] bg-black p-10 overflow-y-auto animate-in slide-in-from-bottom duration-300">
                            <div className="max-w-md mx-auto space-y-12 pb-24">
                                <div className="flex justify-between items-center">
                                    <h2 className="text-2xl font-black tracking-widest italic text-white uppercase">Settings</h2>
                                    <button onClick={() => setShowSettings(false)} className="w-12 h-12 bg-white text-black rounded-full flex items-center justify-center active:scale-90 transition-transform"><Icons.X/></button>
                                </div>
                                <div className="space-y-10">
                                    <div className="space-y-4">
                                        <p className="text-[10px] font-black text-white/30 uppercase tracking-widest">對象管理 (TARGETS)</p>
                                        <div className="flex gap-2">
                                            <input value={newTargetInput} onChange={e => setNewTargetInput(e.target.value)} onKeyDown={e => e.key === 'Enter' && handleAddTarget()} className="flex-1 bg-white/5 rounded-xl border border-white/5 p-4 text-xs font-black text-white" placeholder="新增對象名稱..." />
                                            <button onClick={handleAddTarget} className="bg-white text-black px-6 rounded-xl font-black active:scale-95">+</button>
                                        </div>
                                        <div className="flex flex-wrap gap-2 pt-2">
                                            {targets.map(t => (
                                                <div key={t} className="px-4 py-2 bg-zinc-900 border border-white/5 rounded-lg text-[10px] font-black flex items-center gap-3">
                                                    <span>{t}</span>
                                                    <button onClick={() => {const n = targets.filter(x => x !== t); setTargets(n); saveTags(n, cats);}} className="text-red-500 opacity-60 hover:opacity-100">✕</button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                    <div className="space-y-4">
                                        <p className="text-[10px] font-black text-white/30 uppercase tracking-widest">分類管理 (CATEGORIES)</p>
                                        <div className="flex gap-2">
                                            <input value={newCatInput} onChange={e => setNewCatInput(e.target.value)} onKeyDown={e => e.key === 'Enter' && handleAddCat()} className="flex-1 bg-white/5 rounded-xl border border-white/5 p-4 text-xs font-black text-white" placeholder="新增分類名稱..." />
                                            <button onClick={handleAddCat} className="bg-white text-black px-6 rounded-xl font-black active:scale-95">+</button>
                                        </div>
                                        <div className="flex flex-wrap gap-2 pt-2">
                                            {cats.map(c => (
                                                <div key={c} className="px-4 py-2 bg-zinc-900 border border-white/5 rounded-lg text-[10px] font-black flex items-center gap-3">
                                                    <span>{c}</span>
                                                    <button onClick={() => {const n = cats.filter(x => x !== c); setCats(n); saveTags(targets, n);}} className="text-red-500 opacity-60 hover:opacity-100">✕</button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* DELETE CONFIRM */}
                    {deleteConfirmId && (
                        <div className="fixed inset-0 z-[200] bg-black/95 flex items-center justify-center p-6 text-center">
                            <div className="bg-zinc-900 p-10 rounded-[2.5rem] border border-white/10 w-full max-w-xs space-y-8 shadow-2xl animate-in zoom-in-95 duration-200">
                                <p className="font-black uppercase tracking-widest text-sm text-white">確認刪除？</p>
                                <div className="flex flex-col gap-3">
                                    <button onClick={() => handleDeleteItem(deleteConfirmId)} className="py-5 bg-red-500 text-white rounded-2xl font-black text-[10px] uppercase active:scale-95 transition-transform">確認</button>
                                    <button onClick={() => setDeleteConfirmId(null)} className="py-5 bg-white/5 text-white/40 rounded-2xl font-black text-[10px] uppercase active:scale-95 transition-transform">取消</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

