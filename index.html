<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>My購了沒(˶˙๏˙˶)b</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            box-sizing: border-box;
        }
        html, body { 
            position: fixed;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #000;
            font-family: 'Noto Sans TC', sans-serif; 
            color: #fff;
        }
        .font-num { font-family: 'Inter', sans-serif; font-weight: 700; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        input, select, textarea {
            background-color: transparent !important;
            border: none;
            outline: none;
            color: white;
            -webkit-appearance: none;
            user-select: text;
        }

        .scroll-container {
            height: 100vh;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 150px;
        }

        .sticky-summary {
            position: sticky;
            top: 0;
            z-index: 40;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            padding-top: 15px;
            padding-bottom: 20px;
        }

        .nav-glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tag-pink { background: #ff7eb9; color: #000; }
        .tag-blue { background: #7ee8ff; color: #000; }
        .tag-purple { background: #b97eff; color: #000; }
        .tag-gray { background: rgba(255, 255, 255, 0.2); color: #fff; }

        .empty-watermark {
            position: fixed;
            top: 55%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            text-align: center;
            z-index: -1;
            pointer-events: none;
            font-size: 60px;
            opacity: 0.1;
        }

        .action-button:active {
            transform: scale(0.92);
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        const Icons = {
            Camera: ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>,
            Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="4" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
            List: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><line x1="9" y1="6" x2="21" y2="6"/><line x1="9" y1="12" x2="21" y2="12"/><line x1="9" y1="18" x2="21" y2="18"/><circle cx="4" cy="6" r="0.8" fill="currentColor"/><circle cx="4" cy="12" r="0.8" fill="currentColor"/><circle cx="4" cy="18" r="0.8" fill="currentColor"/></svg>,
            Stats: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><line x1="6" y1="20" x2="6" y2="8" /><line x1="12" y1="20" x2="12" y2="4" /><line x1="18" y1="20" x2="18" y2="14" /></svg>,
            Tag: () => <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><circle cx="7" cy="7" r="1"/></svg>,
            Plus: ({size=22}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3.5" strokeLinecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
            X: ({size=14}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
            Edit: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
            Trash: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
        };

        const App = () => {
            const [view, setView] = useState('list');
            const [items, setItems] = useState([]);
            const [editingId, setEditingId] = useState(null);
            const [showTags, setShowTags] = useState(false);
            const [name, setName] = useState("");
            const [price, setPrice] = useState("");
            const [currency, setCurrency] = useState("TWD");
            const [img, setImg] = useState(null);
            const [selT, setSelT] = useState("自己");
            const [selC, setSelC] = useState("藥妝");
            const [targets, setTargets] = useState(["自己", "家人", "朋友"]);
            const [categories, setCategories] = useState(["藥妝", "服飾", "零食", "電器"]);
            
            const rates = { JPY: 0.211, KRW: 0.0238 };
            const scrollRef = useRef(null);

            useEffect(() => {
                const savedItems = localStorage.getItem('mybuy_v11_items');
                const savedTags = localStorage.getItem('mybuy_v11_tags');
                if (savedItems) setItems(JSON.parse(savedItems));
                if (savedTags) {
                    const parsed = JSON.parse(savedTags);
                    if(parsed.t) setTargets(parsed.t);
                    if(parsed.c) setCategories(parsed.c);
                }
            }, []);

            useEffect(() => { 
                localStorage.setItem('mybuy_v11_items', JSON.stringify(items));
                localStorage.setItem('mybuy_v11_tags', JSON.stringify({ t: targets, c: categories }));
            }, [items, targets, categories]);

            const getTWD = (item) => {
                let rate = 1;
                if (item.currency === 'JPY') rate = rates.JPY;
                if (item.currency === 'KRW') rate = rates.KRW;
                return (parseFloat(item.price) || 0) * rate;
            };

            const stats = useMemo(() => {
                const bought = items.filter(i => i.bought).reduce((acc, i) => acc + getTWD(i), 0);
                const planned = items.filter(i => !i.bought).reduce((acc, i) => acc + getTWD(i), 0);
                return { bought, planned };
            }, [items]);

            const handleSubmit = () => {
                if (!name.trim()) return;
                if (editingId) {
                    setItems(prev => prev.map(i => i.id === editingId ? { ...i, name: name.trim(), price: parseFloat(price) || 0, currency, target: selT, category: selC, image: img } : i));
                    setEditingId(null);
                } else {
                    setItems(prev => [{ id: Date.now().toString(), name: name.trim(), price: parseFloat(price) || 0, currency, target: selT, category: selC, image: img, bought: false }, ...prev]);
                }
                setName(""); setPrice(""); setImg(null);
            };

            const handleResetData = () => {
                // 直接清空項目列表
                setItems([]);
                setEditingId(null);
                setName(""); setPrice(""); setImg(null);
                setShowTags(false);
            };

            const handleDeleteItem = (id) => {
                setItems(prev => prev.filter(i => i.id !== id));
            };

            const TagManager = ({ title, list, setList }) => {
                const [val, setVal] = useState("");
                return (
                    <div className="space-y-4">
                        <p className="text-[10px] font-black opacity-30 tracking-[0.3em] uppercase pl-1">{title}</p>
                        <div className="flex flex-wrap gap-2">
                            {list.map(tag => (
                                <div key={tag} className="flex items-center bg-white/10 px-4 py-2 rounded-2xl gap-2">
                                    <span className="text-xs font-bold">{tag}</span>
                                    <div onTouchStart={() => setList(list.filter(l => l !== tag))} className="opacity-30 p-1"><Icons.X size={12}/></div>
                                </div>
                            ))}
                        </div>
                        <div className="relative flex items-center">
                            <input value={val} onChange={e => setVal(e.target.value)} className="w-full bg-white/5 rounded-2xl px-5 py-4 text-sm font-bold pr-16 border border-white/10" placeholder="新增..." />
                            <div onTouchStart={() => { if(val.trim()){ setList([...list, val.trim()]); setVal(""); }}} className="absolute right-2 w-10 h-10 bg-white text-black rounded-xl flex items-center justify-center"><Icons.Plus size={18} /></div>
                        </div>
                    </div>
                );
            };

            return (
                <div ref={scrollRef} className="scroll-container no-scrollbar">
                    {!showTags && items.length === 0 && view === 'list' && <div className="empty-watermark">(˶˙๏˙˶)</div>}
                    <div className="w-full max-w-[90%] mx-auto pb-20">
                        <header className="flex justify-between items-center pt-12 mb-4">
                            <h1 className="text-xl font-[900] tracking-tighter">My購了沒 (˶˙๏˙˶)b</h1>
                            <button onTouchStart={() => setShowTags(true)} className="w-12 h-12 nav-glass rounded-2xl flex items-center justify-center"><Icons.Tag /></button>
                        </header>
                        <div className="sticky-summary">
                            <div className="grid grid-cols-2 gap-4 mb-3">
                                <div className="text-center p-2">
                                    <p className="text-[10px] opacity-40 font-black tracking-[0.2em] uppercase mb-1">已花費</p>
                                    <p className="text-2xl font-num text-white tracking-tighter font-num"><span className="text-[10px] opacity-30 mr-1">NT$</span>{Math.round(stats.bought).toLocaleString()}</p>
                                </div>
                                <div className="text-center p-2 border-l border-white/5">
                                    <p className="text-[10px] opacity-40 font-black tracking-[0.2em] uppercase mb-1">預定花費</p>
                                    <p className="text-2xl font-num text-white tracking-tighter opacity-80 font-num"><span className="text-[10px] opacity-30 mr-1">NT$</span>{Math.round(stats.planned).toLocaleString()}</p>
                                </div>
                            </div>
                        </div>

                        {view === 'list' ? (
                            <div className="space-y-8 mt-6 pb-24">
                                <section className="nav-glass rounded-[2.5rem] p-6 space-y-6">
                                    <input value={name} onChange={e => setName(e.target.value)} className="w-full text-xl font-[900] placeholder:opacity-20" placeholder="想買什麼？" />
                                    <div className="flex items-center justify-between border-b border-white/10 pb-3">
                                        <div className="flex items-center gap-3 flex-1">
                                            <span className="text-[9px] font-num opacity-30 tracking-widest uppercase">PRICE</span>
                                            <input type="number" value={price} onChange={e => setPrice(e.target.value)} className="w-full text-2xl font-num" placeholder="0" />
                                        </div>
                                        <select value={currency} onChange={e => setCurrency(e.target.value)} className="w-20 text-right text-sm font-black text-white">
                                            <option value="TWD">TWD</option><option value="JPY">JPY</option><option value="KRW">KRW</option>
                                        </select>
                                    </div>
                                    <div className="space-y-4">
                                        <div className="flex gap-2 overflow-x-auto no-scrollbar">
                                            {targets.map(t => <button key={t} onTouchStart={() => setSelT(t)} className={`px-4 py-2 rounded-xl text-[10px] font-black transition-all flex-none uppercase ${selT === t ? 'bg-white text-black' : 'bg-white/5 text-white/30'}`}>{t}</button>)}
                                        </div>
                                        <div className="flex gap-2 overflow-x-auto no-scrollbar">
                                            {categories.map(c => <button key={c} onTouchStart={() => setSelC(c)} className={`px-4 py-2 rounded-xl text-[10px] font-black transition-all flex-none uppercase ${selC === c ? 'bg-white/20 text-white' : 'bg-white/5 text-white/20'}`}>{c}</button>)}
                                        </div>
                                    </div>
                                    <div className="flex gap-3 pt-2">
                                        <button onTouchStart={() => document.getElementById('cam-btn').click()} className={`w-14 h-14 flex items-center justify-center rounded-2xl border border-white/10 ${img ? 'bg-blue-500/20 text-blue-400 border-blue-500/50' : 'bg-white/5 opacity-30'}`}><Icons.Camera size={24}/></button>
                                        <button onTouchStart={handleSubmit} className="flex-1 bg-white text-black text-[11px] font-black tracking-[0.4em] uppercase rounded-2xl">{editingId ? "更新項目" : "加入清單"}</button>
                                        <input type="file" id="cam-btn" className="hidden" accept="image/*" onChange={e => { const f = e.target.files[0]; if (f) { const r = new FileReader(); r.onload = ev => setImg(ev.target.result); r.readAsDataURL(f); }}} />
                                    </div>
                                </section>

                                <div className="space-y-6">
                                    {items.map(item => (
                                        <div key={item.id} className={`flex flex-col gap-3 p-1 rounded-3xl transition-all ${item.bought ? 'opacity-25 grayscale' : ''}`}>
                                            <div className="flex items-center gap-4">
                                                <div className="w-20 h-20 flex-none rounded-2xl overflow-hidden bg-white/5 border border-white/10 relative">
                                                    {item.image ? <img src={item.image} className="w-full h-full object-cover" /> : <div className="w-full h-full flex items-center justify-center opacity-10"><Icons.Camera /></div>}
                                                    {item.bought && <div className="absolute inset-0 bg-black/40 flex items-center justify-center"><Icons.Check /></div>}
                                                </div>
                                                <div className="flex-1 min-w-0 pr-2">
                                                    <div className="flex gap-1.5 mb-2">
                                                        <span className={`px-2 py-0.5 rounded-lg text-[8px] font-black uppercase ${item.target === '自己' ? 'tag-pink' : item.target === '家人' ? 'tag-blue' : item.target === '朋友' ? 'tag-purple' : 'tag-gray'}`}>{item.target}</span>
                                                        <span className="px-2 py-0.5 rounded-lg text-[8px] font-black bg-white/10 text-white/60 uppercase">{item.category}</span>
                                                    </div>
                                                    <h3 className="font-bold text-sm truncate mb-1">{item.name}</h3>
                                                    <p className="text-xl font-num font-black text-white"><span className="text-[10px] opacity-30 mr-1.5 font-bold">{item.currency}</span>{item.price.toLocaleString()}</p>
                                                </div>
                                                <button onTouchStart={() => setItems(prev => prev.map(i => i.id === item.id ? {...i, bought: !i.bought} : i))} className={`w-12 h-12 rounded-full flex-none flex items-center justify-center ${item.bought ? 'bg-white text-black' : 'border-2 border-white/10 text-white/20'}`}><Icons.Check /></button>
                                            </div>
                                            {!item.bought && (
                                                <div className="flex justify-end gap-6 px-4">
                                                    <button onTouchStart={() => { setEditingId(item.id); setName(item.name); setPrice(item.price.toString()); setCurrency(item.currency); setImg(item.image); setSelT(item.target); setSelC(item.category); scrollRef.current.scrollTo({ top: 0, behavior: 'smooth' }); }} className="flex items-center gap-1.5 text-[10px] font-black text-blue-400 uppercase tracking-widest"><Icons.Edit /> 編輯</button>
                                                    <button onTouchStart={() => handleDeleteItem(item.id)} className="flex items-center gap-1.5 text-[10px] font-black text-red-500 uppercase tracking-widest"><Icons.Trash /> 刪除</button>
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ) : (
                            <div className="py-20 text-center uppercase opacity-20 text-[10px] font-black tracking-widest">
                                先新增點東西再來看統計ㄅ (˶˙๏˙˶)
                            </div>
                        )}
                    </div>
                    
                    <nav className="fixed bottom-10 left-1/2 -translate-x-1/2 flex items-center gap-12 px-10 py-5 rounded-[2.5rem] nav-glass z-[80]">
                        <div onTouchStart={() => {setView('list'); setShowTags(false);}} className={`p-1 ${view === 'list' && !showTags ? 'opacity-100 scale-125' : 'opacity-20'}`}><Icons.List/></div>
                        <div onTouchStart={() => {setView('stats'); setShowTags(false);}} className={`p-1 ${view === 'stats' && !showTags ? 'opacity-100 scale-125' : 'opacity-20'}`}><Icons.Stats/></div>
                    </nav>

                    {showTags && (
                        <div className="fixed inset-0 z-[100] bg-black p-6 overflow-y-auto no-scrollbar">
                            <div className="w-full max-w-[90%] mx-auto py-10">
                                <div className="flex justify-between items-center mb-16">
                                    <h2 className="text-3xl font-[900] tracking-tight">Tags</h2>
                                    <button onTouchStart={() => setShowTags(false)} className="px-8 py-3 bg-white text-black rounded-2xl text-[10px] font-black uppercase tracking-widest">完成</button>
                                </div>
                                <div className="space-y-14">
                                    <TagManager title="對象分類 (Who)" list={targets} setList={setTargets} />
                                    <TagManager title="物品分類 (What)" list={categories} setList={setCategories} />
                                    <div className="pt-10 pb-10">
                                        <p className="text-[10px] font-black text-red-500 tracking-[0.3em] uppercase mb-4">危險區域</p>
                                        <div className="border border-red-500/20 rounded-[2rem] p-8 text-center space-y-4">
                                            <p className="text-[11px] text-red-500/70 font-bold leading-relaxed">此操作將清空所有購物清單項目。</p>
                                            <button 
                                                onTouchStart={handleResetData}
                                                className="w-full py-5 rounded-2xl bg-red-600/10 text-red-500 text-[10px] font-black uppercase tracking-widest border border-red-500/20"
                                            >
                                                RESET ALL ITEMS
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

